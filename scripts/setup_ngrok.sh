#!/bin/bash

# –¶–≤–µ—Ç–∞
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo "üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Ngrok –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö webhook'–æ–≤"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ ngrok
if ! command -v ngrok &> /dev/null; then
    echo -e "${YELLOW}‚ö†Ô∏è  Ngrok –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–∫–∞...${NC}"
    cd /tmp
    wget -q https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-arm64.tgz
    tar xzf ngrok-v3-stable-linux-arm64.tgz
    sudo mv ngrok /usr/local/bin/
    rm ngrok-v3-stable-linux-arm64.tgz
    echo -e "${GREEN}‚úÖ Ngrok —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω${NC}"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
echo ""
echo "üìù –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ngrok –Ω—É–∂–µ–Ω authtoken"
echo ""
echo "1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://ngrok.com/"
echo "2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)"
echo "3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à authtoken –∏–∑ –¥–∞—à–±–æ—Ä–¥–∞"
echo ""
read -p "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à ngrok authtoken (–∏–ª–∏ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å): " NGROK_TOKEN

if [ ! -z "$NGROK_TOKEN" ]; then
    ngrok config add-authtoken $NGROK_TOKEN
    echo -e "${GREEN}‚úÖ –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è  –¢–æ–∫–µ–Ω –Ω–µ –≤–≤–µ–¥—ë–Ω. Ngrok –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å.${NC}"
    echo "   –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –ø–æ–∑–∂–µ: ngrok config add-authtoken YOUR_TOKEN"
fi

echo ""
echo "üöÄ –ó–∞–ø—É—Å–∫ ngrok..."

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–π ngrok –µ—Å–ª–∏ –µ—Å—Ç—å
pkill ngrok 2>/dev/null

# –ó–∞–ø—É—Å—Ç–∏—Ç—å ngrok –≤ —Ñ–æ–Ω–µ
nohup ngrok http 3000 > /tmp/ngrok.log 2>&1 &

echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ (5 —Å–µ–∫—É–Ω–¥)..."
sleep 5

# –ü–æ–ª—É—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π URL
NGROK_URL=$(curl -s http://localhost:4040/api/tunnels 2>/dev/null | grep -o '"public_url":"https://[^"]*"' | head -1 | cut -d'"' -f4)

if [ ! -z "$NGROK_URL" ]; then
    echo ""
    echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
    echo -e "${GREEN}‚úÖ Ngrok —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω!${NC}"
    echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
    echo ""
    echo "üåê –í–∞—à –ø—É–±–ª–∏—á–Ω—ã–π URL:"
    echo "   $NGROK_URL"
    echo ""
    echo "üìç Webhook URLs –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö:"
    echo ""
    echo "   Lava webhook:"
    echo "   $NGROK_URL/webhook/lava"
    echo ""
    echo "   Crypto webhook:"
    echo "   $NGROK_URL/webhook/crypto"
    echo ""
    echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
    echo ""
    echo "üìã –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:"
    echo ""
    echo "1Ô∏è‚É£  –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ Lava:"
    echo "   ‚Ä¢ –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://gate.lava.top/"
    echo "   ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Webhook"
    echo "   ‚Ä¢ –í–≤–µ–¥–∏—Ç–µ: $NGROK_URL/webhook/lava"
    echo ""
    echo "2Ô∏è‚É£  –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ 0xProcessing:"
    echo "   ‚Ä¢ –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://app.0xprocessing.com/"
    echo "   ‚Ä¢ Settings ‚Üí Webhook URL"
    echo "   ‚Ä¢ –í–≤–µ–¥–∏—Ç–µ: $NGROK_URL/webhook/crypto"
    echo ""
    echo "3Ô∏è‚É£  –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–ø–ª–∞—Ç—É –≤ –±–æ—Ç–µ @meemee12_bot"
    echo ""
    echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
    echo ""
    echo "üí° –ü–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:"
    echo "   ‚Ä¢ Ngrok –¥–∞—à–±–æ—Ä–¥: http://localhost:4040"
    echo "   ‚Ä¢ –õ–æ–≥–∏ ngrok: tail -f /tmp/ngrok.log"
    echo "   ‚Ä¢ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å: pkill ngrok"
    echo ""
    
    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å URL –≤ —Ñ–∞–π–ª –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥—Ä—É–≥–∏–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏
    echo "$NGROK_URL" > /tmp/ngrok_url.txt
    
else
    echo -e "${YELLOW}‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ngrok URL${NC}"
    echo ""
    echo "–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:"
    echo "1. –ù–µ –≤–≤–µ–¥—ë–Ω authtoken"
    echo "2. –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º"
    echo "3. Ngrok —É–∂–µ –∑–∞–ø—É—â–µ–Ω"
    echo ""
    echo "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:"
    echo "1. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω: ngrok config add-authtoken YOUR_TOKEN"
    echo "2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã: ps aux | grep ngrok"
    echo "3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é: ngrok http 3000"
    echo ""
    echo "–õ–æ–≥–∏ ngrok: tail -f /tmp/ngrok.log"
fi

echo ""
